<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Music player</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w==" crossorigin="anonymous" />
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="  " rel="stylesheet">

<div class="player">
  <!-- Dashboard -->
  <div class="dashboard">
    <!-- Header -->
    <header>
      <h4>Now playing:</h4>
      <h2>String 57th & 9th</h2>
    </header>

    <!-- CD -->
    <div class="cd">
      <div class="cd-thumb" style="background-image: url('https://i.ytimg.com/vi/jTLhQf5KJSc/maxresdefault.jpg')">
      </div>
    </div>

    <!-- Control -->
    <div class="control">
      <div class="btn btn-repeat">
        <i class="fas fa-redo"></i>
      </div>
      <div class="btn btn-prev">
        <i class="fas fa-step-backward"></i>
      </div>
      <div class="btn btn-toggle-play">
        <i class="fas fa-pause icon-pause"></i>
        <i class="fas fa-play icon-play"></i>
      </div>
      <div class="btn btn-next">
        <i class="fas fa-step-forward"></i>
      </div>
      <div class="btn btn-random">
        <i class="fas fa-random"></i>
      </div>
    </div>

    <input id="progress" class="progress" type="range" value="0" step="1" min="0" max="100">

    <audio id="audio" src=""></audio>
    <div class="volum">
      <div class="btn btn-volum">
        <i class="fa-solid fa-volume-high"></i>
        <!-- <i class="fa-solid fa-volume-xmark"></i> -->
      </div>
      <div> <input id="progress-volume" class="progress-volum" type="range" value="100" step="1" min="0" max="100"></div>
     
    </div>
  </div>

  <!-- Playlist -->
  <div class="playlist">
    <div class="song">
      <div class="thumb" style="background-image: url('https://i.ytimg.com/vi/jTLhQf5KJSc/maxresdefault.jpg')">
      </div>
      <div class="body">
        <h3 class="title">Music name</h3>
        <p class="author">Singer</p>
      </div>
      <div class="option">
        <i class="fas fa-ellipsis-h"></i>
      </div>
    </div>
    <div class="song">
      <div class="thumb" style="background-image: url('https://i.ytimg.com/vi/jTLhQf5KJSc/maxresdefault.jpg')">
      </div>
      <div class="body">
        <h3 class="title">Music name</h3>
        <p class="author">Singer</p>
      </div>
      <div class="option">
        <i class="fas fa-ellipsis-h"></i>
      </div>
    </div>
    <div class="song">
      <div class="thumb" style="background-image: url('https://i.ytimg.com/vi/jTLhQf5KJSc/maxresdefault.jpg')">
      </div>
      <div class="body">
        <h3 class="title">Music name</h3>
        <p class="author">Singer</p>
      </div>
      <div class="option">
        <i class="fas fa-ellipsis-h"></i>
      </div>
    </div>
  </div>
</div>

<!-- Design from: https://static.collectui.com/shots/3671744/musicloud-revolutionary-app-for-music-streaming-large -->
<script  href="./main.js">
    const $ =document.querySelector.bind(document);
const $$=document.querySelectorAll.bind(document);
const heading= $('header h2')
const cdThumb=$('.cd-thumb')
const audio=$('#audio')
const cd=$('.cd')
const playBtn=$('.btn-toggle-play')
const player=$('.player')
const repeat=$('.btn-repeat')
const progress=$('#progress')
const progressvolum=$('#progress-volume')
const nextBtn=$('.btn-next')
const preBtn=$('.btn-prev')
const randomBtn=$('.btn-random')
const playlist=$('.playlist')
const vulumBtn=$('.volum')
const muteBtn=$('.btn-volum')
const unMuteBtn=$('.fa-volume-high')
const openMuteByn=$('.fa-volume-xmark')
const PLAYER_STORAGE_KEY='F8-PLAYER'

const app={
  currentIndex:0,
  isPlaying:false,
  isRandom:false,
  isRepeat:false,
  isMute:false,
  config:JSON.parse(localStorage.getItem(PLAYER_STORAGE_KEY)) || {},
songs:[
  {
    name:'Bo Xì Bo',
    singer:'Hoàng Thùy Linh',
    path:'./music/song1.mp3',
    image:'./music/img2.jpg'
  },
  {
    name:'Chân ái',
    singer:'Orange',
    path:'./music/song2.mp3',
    image:'./music/img3.jpg'
  },
  {
    name:'Là do em xuôi thôi',
    singer:'Sofia Khói',
    path:'./music/song3.mp3',
    image:'./music/img4.jpg'
  },
  {
    name:'Yêu 5',
    singer:'Rhymatsic',
    path:'./music/song4.mp3',
    image:'./music/img1.jpg'
  },
  {
    name:'See Tình',
    singer:'Hoàng Thùy Linh',
    path:'./music/song5.mp3',
    image:'./music/img2.jpg'
  },{
    name:'Thói quen',
    singer:'Hoàng Dũng',
    path:'./music/song7.mp3',
    image:'./music/img6.jpg'
  },{
    name:'Tint Love',
    singer:'Thịnh Suy',
    path:'./music/song8.mp3',
    image:'./music/img7.jpg'
  },{
    name:'Vaicaunoicokhiennguoithaydoi',
    singer:'Grey-D',
    path:'./music/song9.mp3',
    image:'./music/img8.jpg'
  },{
    name:'Who You?',
    singer:'G-Dragon',
    path:'./music/song10.mp3',
    image:'./music/img10.jpg'
  }
],
setConfig:function(key,value){
  this.config[key]=value;
  localStorage.setItem(PLAYER_STORAGE_KEY,JSON.stringify(this.config))
},
render:function()
{
  const htmls=this.songs.map((song,index)=>{
    return `
        <div class="song ${index===this.currentIndex? 'active':''}" data-index="${index}">
        <div class="thumb" style="background-image: url(${song.image})">
        </div>
        <div class="body">
          <h3 class="title">${song.name}</h3>
          <p class="author">${song.singer}</p>
        </div>
        <div class="option">
          <i class="fas fa-ellipsis-h"></i>
        </div>
      </div>
    `
  })
    playlist.innerHTML=htmls.join('')
  
  },
  handleEvent:function(){
  
  ///// xử lý xự kiện
   const _this=this
   const cdWidth= cd.offsetWidth
   //cd quay
   const cdThumbanimate=cdThumb.animate([{ transform: "rotate(360deg)" }],{
    duration:10000,iterations:Infinity
   })
   cdThumbanimate.pause()
   
//// play và pause
    playBtn.onclick=function(){
      if (_this.isPlaying){
        audio.pause() 
      }
      else{
        audio.play()
      }
      audio.onplay=function(){
        _this.isPlaying=true
        player.classList.add('playing')
        cdThumbanimate.play()
        
      }
      audio.onpause=function(){
        cdThumbanimate.pause()
        _this.isPlaying=false
        player.classList.remove('playing')
        
      }
    }
    //next song
    nextBtn.onclick=function(){
      if(_this.isRandom){
        _this.playRandomSong()
      }else{
      _this.nextSong()
    }
    audio.play()
    _this.render()
  }
    // pre song
      preBtn.onclick=function(){
        if(_this.isRandom){
          _this.playRandomSong()
        }else{
        _this.prevSong()
      }
      audio.play()
      _this.render()
    }
    // lặp lại bài hát
    repeat.onclick=function(){
      _this.isRepeat = ! _this.isRepeat
      _this.setConfig('isRepeat',_this.isRepeat)
        repeat.classList.toggle('active',_this.isRepeat)
        audio.loop = true;
        audio.load();   
      }
    //bật tắt random
    randomBtn.onclick=function(){
        _this.isRandom = !_this.isRandom
        _this.setConfig('isRandom',_this.isRandom)
        randomBtn.classList.toggle('active',_this.isRandom)
      
    }
    
    //nút tắt tiếng mute
    muteBtn.onclick=function(){
      _this.isMute =! _this.isMute
      if(_this.isMute){
        audio.muted = true
        unMuteBtn.classList.toggle('fa-volume-xmark')}
        else{
          audio.muted = false
          unMuteBtn.classList.remove('fa-volume-xmark')
        }
    }
    //volum progress
    vulumBtn.onchange=function(){
      audio.volume=1
      const progressPercentvolum=progressvolum.value/100*audio.volume
      console.log(progressPercentvolum)
      audio.volume=progressPercentvolum

    }
    // thanh điều khiển current time
   audio.ontimeupdate=function(){
     const progressPercent=audio.currentTime/audio.duration*100
     progress.value=progressPercent
   }
   //tua nhanh thanh điều khiển
   progress.onchange=function(){
    const seekTime=audio.duration/100*progress.value
    audio.currentTime=seekTime
    audio.ontimeupdate=function(){
     const progressPercent=audio.currentTime/audio.duration*100
     progress.value=progressPercent
   }
   }
   // next sang bài khi audio kết thúc
   audio.onended=function(){
        nextBtn.click()

   }
    /// thu nhỏ cd
  document.onscroll=function(){
    const scroll= window.scrollY||document.documentElement.scrollTop
    const newscroll=cdWidth-scroll
    cd.style.width=newscroll>0?newscroll+'px':0
    cd.style.opacity=newscroll/scroll
  }
  //lắng nghe hành vi trong click

  playlist.onclick=function(e){
    const songNode=e.target.closest('.song:not(.active)')
    if(songNode||!e.target.closest('.option') ){
      //xử lý khi click vào song
        if(e.target.closest('.song:not(.active)')){
           _this.currentIndex=Number(songNode.dataset.index)
           _this.loadCurrentSong()
           _this.render();
           audio.play();
        }
      // xử lý khi click vào option
   
    }
    

  }
},defineProperties:function(){
  Object.defineProperty(this,'currentSong',{
    get:function(){
      return this.songs[this.currentIndex]
    }
  })
},
loadCurrentSong:function(){
  const heading= $('header h2')
  const cdthumb=$('.cd-thumb')
  const audio=$('#audio')
  heading.textContent=this.currentSong.name
  cdthumb.style.backgroundImage=`url('${this.currentSong.image}')`
  audio.src=this.currentSong.path

},
loadConfig:function(){
  this.isRandom=this.config.isRandom
  // this.isRepeat=this.config.isRepeat
  //Object.assign(this,this.config)

},
nextSong:function(){
  this.currentIndex++;// JOhn{app} go to shool,he{this} learning English
  if(this.currentIndex>=this.songs.length){
    this.currentIndex=0;
  }
  this.loadCurrentSong()
},
prevSong:function(){
  this.currentIndex--;
  if(this.currentIndex<=0){
    this.currentIndex=0;
  }
  this.loadCurrentSong()
},
playRandomSong:function(){
      let newIndex
      do{
      newIndex=Math.floor(Math.random()*this.songs.length)}
      while( newIndex ===this.currentIndex) 
    this.currentIndex=newIndex
      this.loadCurrentSong();
},
start:function(){
  //Gán cấu hình  , đọc từ Localstorage=> lưu vào config load xong chạy lại cấu hình gốc của mình 
  this.loadConfig();
  // xử lý chức năng
  this.handleEvent()
  // định nghĩa mặc định
  this.defineProperties();
  // cập nhập thông tin hiện tại của bài hát đang phát
  this.loadCurrentSong()
  // load lại
  // hiển thị
  this.render()
  randomBtn.classList.toggle('active',this.isRandom)
  repeat.classList.toggle('active',this.isRepeat)

}
}
app.start()



console.log(Array.prototype)
  </script>
</body>
</html>
